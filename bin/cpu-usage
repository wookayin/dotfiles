#!/usr/bin/env bash

case $OSTYPE in
    linux-gnu)
        # https://unix.stackexchange.com/questions/69185/getting-cpu-usage-same-every-time/
        # CAVEAT: it is not realtime, and takes ~1 second
        cat <(grep 'cpu ' /proc/stat) <(sleep 1 && grep 'cpu ' /proc/stat) | \
        awk -v RS="" '{printf "%.2f", ($13-$2+$15-$4)*100/($13-$2+$15-$4+$16-$5) "%"}'
    ;;
    darwin*)
        # https://stackoverflow.com/questions/30855440/how-to-get-cpu-utilization-in-in-terminal-mac
        ps axo %cpu | awk '{ sum+=$1 } END { printf "%.2f\n", sum }'
    ;;
    *)
        echo "Not supported this OS"
    ;;
esac