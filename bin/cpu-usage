#!/usr/bin/env bash

# https://unix.stackexchange.com/questions/69185/getting-cpu-usage-same-every-time/
# CAVEAT: it is not realtime, and takes ~1 second

cat <(grep 'cpu ' /proc/stat) <(sleep 1 && grep 'cpu ' /proc/stat) | \
    awk -v RS="" '{printf "%.2f", ($13-$2+$14-$3+$15-$4+$18-$7+$19-$8+$20-$9)*100/($13-$2+$14-$3+$15-$4+$16-$5+$17-$6+$18-$7+$19-$8+$20-$9) "%"}'
